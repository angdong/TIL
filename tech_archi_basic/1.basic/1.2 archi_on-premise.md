# 1.2 기본 아키텍처(온프레미스)
- [1.2 기본 아키텍처(온프레미스)](#12-기본-아키텍처온프레미스)
  - [스토리지 아키텍처](#스토리지-아키텍처)
    - [스토리지-서버 간 연결 방식](#스토리지-서버-간-연결-방식)
    - [외장 스토리지 아키텍처 도식화](#외장-스토리지-아키텍처-도식화)
    - [SAN 구성 도식화](#san-구성-도식화)
    - [스토리지 채널 이중화](#스토리지-채널-이중화)
    - [SAN 환경에 주로 사용하는 인터페이스 비교](#san-환경에-주로-사용하는-인터페이스-비교)
  - [네트워크 아키텍처](#네트워크-아키텍처)
    - [네트워크 연결](#네트워크-연결)
    - [Teaming(Bonding)](#teamingbonding)
    - [FCoE(Fibre Channel Over Ethernet)](#fcoefibre-channel-over-ethernet)
    - [DPDK(Data Plane Development Kit)](#dpdkdata-plane-development-kit)



## 스토리지 아키텍처

### 스토리지-서버 간 연결 방식

1. DAS\
    서버와 스토리지 직접 연결

    1대1 매칭을 해야 하기 때문에 연결되는 서버가 많아질수록 DAS로 구현이 어렵다.(스토리지 포트 개수가 적기 때문)

2. NAS\
    네트웍을 통한 파일시스템 공유

    같은 파일 시스템을 여러 서버가 공유해서 사용 가능

    단점: 네트워크를 사용하기 때문에 대역폭을 많이 소모하게 됨

3. SAN\
    SAN 스위치를 통한 채널 관리

    서버에서 나오는 케이블과 스토리지에서 나오는 케이블을 모두 SAN 스위치가 받아서 서로 채널을 맺어주는 구조

    연결되는 서버가 많아지면 DAS에 비해 효율적이게 됨

    단점: SAN스위치 사야하고, 유지보수 해야함

### 외장 스토리지 아키텍처 도식화

1. 물리적 DISK로 RAID구성
2. 데이터를 쓸 때에는 펼쳐져서 쓰여짐(__Striping__)\
$\to$ I/O 발생시 여러 디스크가 한 번에 동작하므로 성능 $\uparrow$
3. 모인 디스크는 논리볼륨(LUN) 이 됨
4. 이후 서버에서 필요한만큼 LUN을 분할(100GB 12개, 600GB 1개, $\dots$)
5. LUN을 FA Port에 할당 _(스토리지 캐시로 성능 향상)_
6.  서버의 HBA와 스토리지의 FA Port를 FC케이블로 연결\
$\to$ 서버가 해당하는 LUN에 접근할 준비가 된 상태

### SAN 구성 도식화

SAN: 서버와 스토리지에서 나오는 케이블을 받아서 교통정리(__Zoning__)

여러 스토리지들을 하나의 네트워크에 연결시킨 다음 이 네트워크를 스토리지 전용 네트워크로 구성하는 방식\
$\cdot$ 스토리지에 접근하기 위해서는 각 호스트들은 모두 SAN 전용 네트워크를 거쳐서 접근

FA-Port <-> <u>__SAN 스위치 Port__</u> <-> 서버

### 스토리지 채널 이중화

MPIO로 스토리지 이중화 구현하여 여러 채널로 보이는 디스크를 dm-3라는 가상 기기로 묶어서 파일시스템은 가상 device를 사용하여 생성

### SAN 환경에 주로 사용하는 인터페이스 비교
|    |FC|iSCSI|Infiniband|
|----|--|-----|----------|
|특징|많이 쓰임|SMB or 가상환경, 별도의 네트워크|가까이 있는 장비에 고속의 연결 지원|
|장점|성능 좋음|비용 쌈|성능 좋음|
|단점|비쌈, zoning필요|느리다|거리가 짧다(15m)|
|용도|대용량 DB등 안정성 필요한 시스템|저용량/통합 스토리지 환경|고속의 appliance|

## 네트워크 아키텍처

### 네트워크 연결

컴퓨터와 네트워크의 연결은 NIC(network interface card = ethernet card) 가 담당

|구분|상세설명|비고|
|---|-|-|
|Ethernet|물리적인 신호와 배선, 논리적으로 상대방 확인하는 방법을 정의한 네트워크 구성 방식 <br>LAN 환경에서 주로 사용|OSI 7 Layer의 1, 2 Layer|
|MAC|Ethernet 상에서 상대방 확인하는 48비트 고유 주소체계<br>NIC(port)별로 고유하게 부여||

네트워크 연결에 사용되는 인터페이스
* FC
* UTP

컴퓨터는 NIC와 스위치를 연결하여 네트워크 사용 가능\
OSI 7계층 구조 중 어느 레벨에서 동작하느냐에 따라 아래와 같이 구분됨

1. L2 스위치

    2레이어인 ethernet 레벨에서 동작\
    MAC보고 적절한 포트로 패킷 전송(L2에는 ip가 없기 때문)

2. L3 스위치

    3레이어의 프로토콜인 IP등에서 스위칭\
    IP를 보고 적절한 포트로 패킷 전송\
    **라우팅 가능**

3. L4 스위치

    4레이어의 프로토콜인 TCP/UDP 등에서 스위칭\
    TCP/UDP 포트를 보고 적절한 포트로 패킷 전송\
    **로드 밸런싱 가능**

4. L7 스위치

    7레이어에서 동작\
    HTTP의 URL, FTP의 파일명 분석 가능\
    보안 기능 가능, 더욱 정교한 로드 밸런싱 가능

* L2/L3/L4 스위치 구성도

![스위치 구성도](../../img/switches.PNG "스위치 구성도(출처: https://blog.naver.com/novaenc/220779198831)")

* 라우팅

목적지 IP를 보고 적절한 경로로 패킷을 송부하도록 지정하는 것\
`tracert`(window) `traceroute`(linux) 명령어로 OS에서 라우팅 확인 가능

* 서브넷

할당받은 네트워크를 효율적으로 사용하기 위해 여러개의 네트워크로 나누는 것

> 넷마스크: 네트워크 주소 부분의 비트를 1로 치환한 것

예1)\
서브넷: 192.168.10.0/<span style="color:yellow">24</span>\
서브넷 IP 범위: 192.168.10.0~192.168.10.<span style="color:yellow">255</span>\
넷마스크: 255.255.255.0\
사용가능 IP개수: 254개(맨 앞의 0번과 맨 뒤의 255번은 못 씀)

예2)\
서브넷: 192.168.10.0/<span style="color:yellow">25</span>\
서브넷 IP 범위: 192.168.10.0~192.168.10.<span style="color:yellow">127</span>\
넷마스크: 255.255.255.128\
사용가능 IP개수: 126개(맨 앞의 0번과 맨 뒤의 127번은 못 씀)

IP의 예)\
192.168.10.0/26 서브넷의 192.168.10.30 IP\
Host IP &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red">11000000 10101000 00001010 00</span><span style="color:green">011110</span>\
Subnet &nbsp;&nbsp;&nbsp; <span style="color:red">11000000 10101000 00001010 00</span>000000\
Netmask&nbsp; <span style="color:red">11111111 11111111 11111111 11</span>000000\
$\to$ 적색(26개)이 서브넷 주소, 녹색(6개)이 서브냇 내의 IP주소

### Teaming(Bonding)
네트워크 인터페이스 이중화를 위해 두 NIC를 묶어서 가상의 NIC생성

실제 물리적인 NIC 2개를 묶어서(**teaming**) team1 이라는 가상의 NIC를 생성하며, IP는 가상의 NIC에 할당하여 사용

### FCoE(Fibre Channel Over Ethernet)

서버는 Network 연결을 위한 Ethernet NIC 및 디스크 연결을 위한 HBA가 필요하고, 이에 따른 별도의 케이블링 및 스위치 장비가 필요함\
$\to$ 서버의 NIC와 HBA를 대역폭이 큰 하나의 채널로 묶는다

### DPDK(Data Plane Development Kit)

네트워크 패킷을 OS(커널)을 통하지 않고 바로 NIC로 넘기는 것\
$\to$ 네트워크 성능 향상

구성

1. 고속 패킷 처리를 위한 데이터 플레인 라이브러리
2. 네트워크 인터페이스 컨트롤러(NIC) 드라이버